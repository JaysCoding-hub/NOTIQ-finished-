<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Filme / Serien</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Bestehende Styles ... */
        body {
            background: #1a1625;
            color: #e0e0e0;
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .headline {
            font-size: 2.2rem;
            color: #a259ff;
            font-family: 'Montserrat', Arial, sans-serif;
            letter-spacing: 0.12em;
            font-weight: 700;
            margin: 38px 0 18px 38px;
            text-align: left;
        }
        .section-title {
            font-size: 1.3rem;
            color: #fff;
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 600;
            margin: 32px 0 12px 38px;
            text-align: left;
            letter-spacing: 0.08em;
        }
        .carousel {
            display: flex;
            overflow-x: auto;
            gap: 22px;
            padding: 0 0 8px 38px;
            scrollbar-width: thin;
            scrollbar-color: #a259ff #23232b;
        }
        .carousel::-webkit-scrollbar {
            height: 8px;
            background: #23232b;
        }
        .carousel::-webkit-scrollbar-thumb {
            background: #a259ff;
            border-radius: 8px;
        }
        .card {
            flex: 0 0 180px;
            background: #23232b;
            border-radius: 18px;
            box-shadow: 0 2px 12px rgba(60,60,120,0.13);
            overflow: hidden;
            position: relative;
            transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
            cursor: pointer;
        }
        .card:hover {
            transform: scale(1.07);
            box-shadow: 0 8px 32px 0 #a259ff44;
            z-index: 2;
        }
        .card-img {
            width: 100%;
            height: 240px;
            object-fit: cover;
            background: #191927;
            display: block;
        }
        .card-title {
            font-size: 1.05rem;
            color: #fff;
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 600;
            margin: 12px 0 10px 0;
            padding: 0 14px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .plus-btn {
            position: fixed;
            right: 32px;
            bottom: 32px;
            width: 62px;
            height: 62px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a259ff 60%, #6d28d9 100%);
            color: #fff;
            border: none;
            box-shadow: 0 4px 24px #a259ff55;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.7rem;
            cursor: pointer;
            z-index: 100;
            transition: background 0.18s, box-shadow 0.18s;
        }
        .plus-btn:hover {
            background: linear-gradient(135deg, #a259ff 80%, #7c3aed 100%);
            box-shadow: 0 8px 32px #a259ff99;
        }
        .main-content {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .modal-bg {
            position: fixed;
            left: 0; top: 0; right: 0; bottom: 0;
            background: rgba(30,20,60,0.85);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal {
            background: #23232b;
            border-radius: 18px;
            box-shadow: 0 4px 32px #a259ff55;
            padding: 32px 28px 24px 28px;
            min-width: 340px;
            max-width: 94vw;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 18px;
        }
        .modal label {
            color: #a259ff;
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }
        .modal input, .modal select {
            background: #191927;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 1rem;
            margin-bottom: 10px;
            font-family: inherit;
        }
        .modal input[type="file"] {
            color: #fff;
            background: none;
            padding: 0;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 8px;
        }
        .modal-btn {
            background: #a259ff;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 22px;
            font-size: 1.1rem;
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.18s;
        }
        .modal-btn.cancel {
            background: #23232b;
            color: #a259ff;
            border: 1px solid #a259ff;
        }
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #a259ff;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px #a259ff44;
            opacity: 0.85;
            transition: background 0.18s, opacity 0.18s;
            z-index: 10;
        }
        .remove-btn:hover {
            background: #7c3aed;
            opacity: 1;
        }
        .watched-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #43e97b;
            color: #23232b;
            border: none;
            border-radius: 18px;
            padding: 6px 18px;
            font-size: 1rem;
            font-family: 'Montserrat', Arial, sans-serif;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px #43e97b44;
            opacity: 0.92;
            transition: background 0.18s, opacity 0.18s;
            z-index: 10;
        }
        .watched-btn:hover {
            background: #2ecc71;
            opacity: 1;
        }
        .empty-hint {
            color: #a259ff;
            font-size: 1.1rem;
            margin: 36px 0 0 38px;
            font-family: 'Montserrat', Arial, sans-serif;
            opacity: 0.7;
        }
        /* Responsive adjustments */
        @media (max-width: 900px) {
            .headline {
                font-size: 1.5rem;
                margin: 22px 0 12px 18px;
            }
            .section-title {
                font-size: 1.05rem;
                margin: 18px 0 8px 18px;
            }
            .carousel {
                gap: 10px;
                padding-left: 10px;
            }
            .card {
                flex: 0 0 140px;
            }
            .card-img {
                height: 120px;
            }
        }
        @media (max-width: 600px) {
            .headline {
                font-size: 1.1rem;
                margin: 14px 0 8px 8px;
            }
            .section-title {
                font-size: 0.95rem;
                margin: 12px 0 6px 8px;
            }
            .carousel {
                gap: 6px;
                padding-left: 4px;
            }
            .card {
                flex: 0 0 110px;
                border-radius: 10px;
            }
            .card-img {
                height: 70px;
                border-radius: 10px;
            }
            .plus-btn, #ks-watched-btn {
                width: 44px;
                height: 44px;
                font-size: 1.5rem;
                right: 16px !important;
                bottom: 16px !important;
            }
            #ks-watched-btn {
                right: 70px !important;
            }
            .modal {
                min-width: 90vw;
                padding: 18px 8px 14px 8px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:700&display=swap" rel="stylesheet">
</head>
<body>
    <a href="index.html" title="Zurück" style="
        position: fixed;
        top: 24px;
        right: 32px;
        z-index: 2000;
        text-decoration: none;
        color: #a259ff;
        font-size: 1.35rem;
        font-family: 'Montserrat', Arial, sans-serif;
        background: rgba(35,35,43,0.92);
        border-radius: 28px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 12px #a259ff33;
        transition: background 0.18s, color 0.18s;
        padding: 0 22px 0 18px;
        min-width: 90px;
        gap: 8px;
    " onmouseover="this.style.background='#a259ff';this.style.color='#fff';" onmouseout="this.style.background='rgba(35,35,43,0.92)';this.style.color='#a259ff';">
        Zurück
        <span style="font-size:1.1rem; margin-left:4px; display:inline-block; vertical-align:middle;">&#8592;</span>
    </a>
    <div class="headline">Filme & Serien</div>
    <div class="main-content">
        <div class="section-title">Serien</div>
        <div class="carousel" id="ks-series-list">
            <!-- Dynamisch -->
        </div>
        <div class="empty-hint" id="ks-series-empty">Noch keine Serien hinzugefügt.</div>
        <div class="section-title">Filme</div>
        <div class="carousel" id="ks-movies-list">
            <!-- Dynamisch -->
        </div>
        <div class="empty-hint" id="ks-movies-empty">Noch keine Filme hinzugefügt.</div>
    </div>
    <button class="plus-btn" title="Hinzufügen" id="ks-add-btn">+</button>
    <button id="ks-watched-btn" title="Angeschaut" style="
        position: fixed;
        right: 110px;
        bottom: 32px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6d28d9 60%, #a259ff 100%);
        color: #fff;
        border: none;
        box-shadow: 0 4px 18px #a259ff44;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 101;
        transition: background 0.18s, box-shadow 0.18s;
    ">
        👁️
    </button>
    <!-- Modal für "angeschaut" -->
    <div id="ks-watched-modal-bg" class="modal-bg" style="display:none;">
        <div class="modal" style="max-width:500px;">
            <div style="font-size:1.3rem;color:#a259ff;font-family:'Montserrat',Arial,sans-serif;font-weight:700;margin-bottom:12px;">
                Angeschaut
            </div>
            <div id="ks-watched-list" style="max-height:320px;overflow-y:auto;">
                <!-- Dynamisch -->
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-btn cancel" id="ks-watched-close-btn">Schließen</button>
            </div>
        </div>
    </div>
    <!-- Modal für Hinzufügen -->
    <div id="ks-modal-bg" class="modal-bg" style="display:none;">
        <form class="modal" id="ks-add-form">
            <label for="ks-type">Typ</label>
            <select id="ks-type" required>
                <option value="serie">Serie</option>
                <option value="film">Film</option>
            </select>
            <label for="ks-title">Titel</label>
            <input id="ks-title" type="text" placeholder="Titel" required maxlength="40" autocomplete="off"/>
            <label for="ks-img">Bild (URL oder Datei)</label>
            <input id="ks-img" type="url" placeholder="https://..." autocomplete="off"/>
            <input id="ks-imgfile" type="file" accept="image/*" style="margin-bottom:10px; color:#fff;"/>
            <div class="modal-actions">
                <button type="button" class="modal-btn cancel" id="ks-cancel-btn">Abbrechen</button>
                <button type="submit" class="modal-btn">Hinzufügen</button>
            </div>
        </form>
    </div>
    <!-- Neues Modal für Optionen bei angeschauten Elementen -->
    <div id="ks-watched-options-modal-bg" class="modal-bg" style="display:none;">
        <div class="modal" style="max-width:400px;">
            <div style="font-size:1.3rem;color:#a259ff;font-family:'Montserrat',Arial,sans-serif;font-weight:700;margin-bottom:12px;">
                Optionen
            </div>
            <div id="ks-watched-options-content" style="display:flex;flex-direction:column;gap:12px;">
                <button type="button" class="modal-btn" id="ks-wait-btn">Auf neue Staffel / Folge warten</button>
                <button type="button" class="modal-btn" id="ks-later-btn">Auf später ansehen</button>
            </div>
            <div class="modal-actions">
                <button type="button" class="modal-btn cancel" id="ks-watched-options-close-btn">Schließen</button>
            </div>
        </div>
    </div>
    <script>
        // --- State ---
        let ksSeries = [];
        let ksMovies = [];
        let ksWatched = [];
        // Aktuell ausgewählter Index in ksWatched für das Optionsfeld
        let currentWatchedIndex = null;

        // --- Local Storage Helpers ---
        const KS_STORAGE_KEY = 'notiq-ks-state-v1';
        function saveKsState() {
            const state = { ksSeries, ksMovies, ksWatched };
            localStorage.setItem(KS_STORAGE_KEY, JSON.stringify(state));
        }
        function loadKsState() {
            try {
                const state = JSON.parse(localStorage.getItem(KS_STORAGE_KEY));
                if (state) {
                    ksSeries = Array.isArray(state.ksSeries) ? state.ksSeries : [];
                    ksMovies = Array.isArray(state.ksMovies) ? state.ksMovies : [];
                    ksWatched = Array.isArray(state.ksWatched) ? state.ksWatched : [];
                }
            } catch {}
        }

        // --- DOM ---
        const addBtn = document.getElementById('ks-add-btn');
        const modalBg = document.getElementById('ks-modal-bg');
        const cancelBtn = document.getElementById('ks-cancel-btn');
        const addForm = document.getElementById('ks-add-form');
        const typeInput = document.getElementById('ks-type');
        const titleInput = document.getElementById('ks-title');
        const imgInput = document.getElementById('ks-img');
        const imgFileInput = document.getElementById('ks-imgfile');
        const seriesList = document.getElementById('ks-series-list');
        const moviesList = document.getElementById('ks-movies-list');
        const seriesEmpty = document.getElementById('ks-series-empty');
        const moviesEmpty = document.getElementById('ks-movies-empty');
        const watchedBtn = document.getElementById('ks-watched-btn');
        const watchedModalBg = document.getElementById('ks-watched-modal-bg');
        const watchedList = document.getElementById('ks-watched-list');
        const watchedCloseBtn = document.getElementById('ks-watched-close-btn');

        // Elemente für Optionsmodal
        const watchedOptionsModalBg = document.getElementById('ks-watched-options-modal-bg');
        const watchedOptionsCloseBtn = document.getElementById('ks-watched-options-close-btn');
        const waitBtn = document.getElementById('ks-wait-btn');
        const laterBtn = document.getElementById('ks-later-btn');

        // --- Helpers ---
        function render() {
            // Serien
            seriesList.innerHTML = '';
            if (ksSeries.length === 0) {
                seriesEmpty.style.display = '';
            } else {
                seriesEmpty.style.display = 'none';
                ksSeries.forEach((s, i) => {
                    seriesList.appendChild(createCard(s, i, 'serie'));
                });
            }
            // Filme
            moviesList.innerHTML = '';
            if (ksMovies.length === 0) {
                moviesEmpty.style.display = '';
            } else {
                moviesEmpty.style.display = 'none';
                ksMovies.forEach((m, i) => {
                    moviesList.appendChild(createCard(m, i, 'film'));
                });
            }
            saveKsState();
        }

        function createCard(item, idx, type) {
            const card = document.createElement('div');
            card.className = 'card';
            // Remove button
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = '×';
            removeBtn.title = 'Entfernen';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                if (type === 'serie') {
                    ksSeries.splice(idx, 1);
                } else {
                    ksMovies.splice(idx, 1);
                }
                render();
            };
            card.appendChild(removeBtn);
            // Watched button
            const watchedBtnCard = document.createElement('button');
            watchedBtnCard.className = 'watched-btn';
            watchedBtnCard.innerText = 'Fertig';
            watchedBtnCard.title = 'Als geschaut markieren';
            watchedBtnCard.onclick = (e) => {
                e.stopPropagation();
                card.classList.add('watched-anim');
                card.style.transition = 'opacity 0.4s, transform 0.4s';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.85)';
                setTimeout(() => {
                    if (type === 'serie') {
                        ksWatched.push({ ...ksSeries[idx], type: 'Serie' });
                        ksSeries.splice(idx, 1);
                    } else {
                        ksWatched.push({ ...ksMovies[idx], type: 'Film' });
                        ksMovies.splice(idx, 1);
                    }
                    render();
                }, 350);
            };
            card.appendChild(watchedBtnCard);
            // Image
            const img = document.createElement('img');
            img.className = 'card-img';
            img.src = item.img || 'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80';
            img.alt = item.title;
            card.appendChild(img);
            // Title
            const title = document.createElement('div');
            title.className = 'card-title';
            title.innerText = item.title;
            card.appendChild(title);
            return card;
        }

        // --- Modal logic ---
        addBtn.onclick = () => {
            modalBg.style.display = 'flex';
            addForm.reset();
            typeInput.value = 'serie';
            titleInput.focus();
        };
        cancelBtn.onclick = () => {
            modalBg.style.display = 'none';
        };
        modalBg.onclick = (e) => {
            if (e.target === modalBg) modalBg.style.display = 'none';
        };

        addForm.onsubmit = async (e) => {
            e.preventDefault();
            const type = typeInput.value;
            const title = titleInput.value.trim();
            let img = imgInput.value.trim();
            // If no URL, check file input
            if (!img && imgFileInput.files && imgFileInput.files[0]) {
                img = await fileToDataUrl(imgFileInput.files[0]);
            }
            if (!title) return;
            const entry = { title, img };
            if (type === 'serie') {
                ksSeries.push(entry);
            } else {
                ksMovies.push(entry);
            }
            modalBg.style.display = 'none';
            render();
        };

        function fileToDataUrl(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.readAsDataURL(file);
            });
        }

        // Watched modal logic
        watchedBtn.onclick = () => {
            watchedModalBg.style.display = 'flex';
            watchedList.innerHTML = '';
            if (ksWatched.length === 0) {
                watchedList.innerHTML = '<div style="color:#a259ff;opacity:0.7;">Noch nichts angeschaut.</div>';
            } else {
                ksWatched.forEach((item, index) => {
                    const row = document.createElement('div');
                    row.style.display = 'flex';
                    row.style.alignItems = 'center';
                    row.style.gap = '16px';
                    row.style.marginBottom = '18px';
                    row.style.background = '#23232b';
                    row.style.borderRadius = '12px';
                    row.style.padding = '10px 12px';
                    row.style.cursor = 'pointer';
                    // Bild
                    const img = document.createElement('img');
                    img.src = item.img || 'https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400&q=80';
                    img.alt = item.title;
                    img.style.width = '54px';
                    img.style.height = '54px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '8px';
                    img.style.background = '#191927';
                    // Info
                    const info = document.createElement('div');
                    info.innerHTML = `<div style="font-weight:600;font-size:1.08rem;">${item.title}</div>
                        <div style="font-size:0.98rem;color:#a259ff;">${item.type}</div>`;
                    row.appendChild(img);
                    row.appendChild(info);
                    // Beim Klick auf ein Zeilenelement wird das Optionsmodal geöffnet
                    row.onclick = () => {
                        currentWatchedIndex = index;
                        watchedOptionsModalBg.style.display = 'flex';
                    };
                    watchedList.appendChild(row);
                });
            }
        };
        watchedCloseBtn.onclick = () => {
            watchedModalBg.style.display = 'none';
        };
        watchedModalBg.onclick = (e) => {
            if (e.target === watchedModalBg) watchedModalBg.style.display = 'none';
        };

        // Optionsmodal Logik
        watchedOptionsCloseBtn.onclick = () => {
            watchedOptionsModalBg.style.display = 'none';
        };
        watchedOptionsModalBg.onclick = (e) => {
            if (e.target === watchedOptionsModalBg) watchedOptionsModalBg.style.display = 'none';
        };

        // Beispiel-Eventhandler für die Options-Buttons
        waitBtn.onclick = () => {
            // Hier kann der Code ergänzt werden,
            // der den Zustand "Auf neue Staffel / Folge warten" verarbeitet.
            console.log('Warten ausgewählt für:', ksWatched[currentWatchedIndex]);
            watchedOptionsModalBg.style.display = 'none';
        };

        laterBtn.onclick = () => {
            // Hier kann der Code ergänzt werden,
            // der den Zustand "Auf später ansehen" verarbeitet.
            console.log('Später ansehen ausgewählt für:', ksWatched[currentWatchedIndex]);
            watchedOptionsModalBg.style.display = 'none';
        };

        // --- Initial load & render ---
        loadKsState();
        render();
    </script>
</body>
</html>
